<div class="min-h-screen bg-gray-50" [class.hidden]="isTableExpanded">

  <!-- MAIN WRAPPER -->
  <div class="max-w-[1800px] ml-0 mr-auto pl-2 pr-4 py-4 space-y-6">

    <!-- ================= HEADER ================= -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">

      <!-- Title -->
      <h1 class="text-[22px] font-semibold text-gray-900 tracking-tight">
        CLO Colors Data & Insights
      </h1>

    </div>

    <!-- ================= TOP GRID ================= -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

      <!-- AVAILABLE COLORS CARD -->
      <div class="lg:col-span-5">
        <p-card class="!shadow-sm !rounded-2xl !border-gray-200 h-full">

          <!-- Card Header -->
          <div class="flex justify-between items-center mb-2 px-1 mt-1">
            <h2 class="text-[17px] font-semibold text-gray-900">
              Available Colors
            </h2>
            <i class="pi pi-info-circle text-gray-400 hover:text-gray-600"></i>
          </div>

          <!-- CHART AREA (tight padding like screenshot) -->
          <div class="h-[260px] mt-1 -mb-4 -mx-4">
            <p-chart 
              type="bar"
              [data]="availableColorsChart"
              [options]="availableColorsOptions"
              class="h-full w-full">
            </p-chart>
          </div>

        </p-card>
      </div>

      <!-- BID / ASK CARD -->
      <div class="lg:col-span-4">
        <p-card class="!shadow-sm !rounded-2xl !border-gray-200 h-full flex flex-col">

          <h2 class="text-[17px] font-semibold text-gray-900 mb-2">Bid / Ask Spreads</h2>

          <div class="flex-1 flex items-center justify-center">
            <span class="text-xl text-gray-400 font-medium">Coming Soon</span>
          </div>

        </p-card>
      </div>

      <!-- RIGHT PANEL -->
      <div class="lg:col-span-3">
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-5 space-y-4 h-full flex flex-col">

          <div class="space-y-3 flex-1">

            <button pButton label="Refresh Colors Now"
              class="w-full !bg-gray-900 hover:!bg-black !text-white !rounded-xl !py-3.5 !text-sm font-semibold">
            </button>

            <button pButton label="Override & Run"
              class="w-full !bg-gray-800 hover:!bg-gray-900 !text-white !rounded-xl !py-3.5 !text-sm font-semibold">
            </button>

            <div class="border-t border-gray-200 pt-4 space-y-3">

              <button pButton icon="pi pi-upload" label="Import Sample"
                class="w-full !bg-white !text-gray-700 !border !border-gray-300 hover:!bg-gray-50 !rounded-lg !py-3 justify-start">
              </button>

              <button pButton icon="pi pi-cog" label="Rules & Presets"
                class="w-full !bg-white !text-gray-700 !border !border-gray-300 hover:!bg-gray-50 !rounded-lg !py-3 justify-start">
              </button>

              <button pButton icon="pi pi-history" label="Restore last run"
                class="w-full !bg-white !text-gray-700 !border !border-gray-300 hover:!bg-gray-50 !rounded-lg !py-3 justify-start">
              </button>

              <button pButton icon="pi pi-clock" label="Corn Jobs & Time"
                class="w-full !bg-white !text-gray-700 !border !border-gray-300 hover:!bg-gray-50 !rounded-lg !py-3 justify-start">
              </button>

            </div>
          </div>

          <!-- TIMER -->
          <div class="pt-3 border-t text-right text-xs text-gray-600">
            Next Run in <span class="font-mono font-bold text-gray-900">{{ nextRunTimer }}</span>
          </div>

        </div>
      </div>

    </div>

    <!-- ================= SEARCH / FILTERS BAR ================= -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-5">

      <div class="flex flex-col sm:flex-row flex-wrap items-center gap-4">

        <span class="p-input-icon-left w-full sm:w-auto">
          <i class="pi pi-search"></i>
          <input pInputText placeholder="Search Message ID" class="w-full sm:w-64">
        </span>

        <div class="flex flex-wrap gap-3">
          <button pButton icon="pi pi-sliders-h" label="Filters" 
                  (click)="showFilterDialog()" 
                  class="p-button-outlined"></button>
          <button pButton icon="pi pi-file-import" label="Import ID via Excel" class="p-button-outlined"></button>
        </div>

        <div class="flex-1"></div>

        <div class="flex items-center gap-3">
          <button pButton icon="pi pi-download" label="Export All" class="p-button-text"></button>

          <div class="px-5 py-2 rounded-full bg-gray-100 text-gray-800 font-semibold flex items-center gap-3">
            Total Count
            <span class="px-4 py-1 bg-white rounded-full shadow text-lg font-bold">670</span>
          </div>

          <button pButton label="Fetch Data" class="!bg-gray-900 !text-white !py-2 !px-4 rounded-lg text-sm"></button>
        </div>

      </div>

      <div class="flex flex-wrap items-center gap-3 mt-5">
        <p-chip label="Color: Bwic Cover | Px: Less than 100" removable="true"></p-chip>
        <p-chip label="Color: Market | Date: Today" removable="true"></p-chip>
        <button class="text-xs text-blue-600 ml-auto hover:underline">Remove all filters</button>
      </div>

    </div>

    <!-- ================= TABLE ================= -->
    <p-card class="!shadow-sm !rounded-2xl !border-gray-200">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold text-gray-900">Data Table</h3>
        <button 
          pButton 
          [icon]="isTableExpanded ? 'pi pi-compress' : 'pi pi-expand'" 
          class="p-button-text p-button-plain !text-gray-500 hover:!text-gray-700"
          (click)="toggleTableExpansion()"
          [pTooltip]="isTableExpanded ? 'Minimize Table' : 'Expand Table'">
        </button>
      </div>
      <p-table [value]="tableData" [scrollable]="true" scrollHeight="500px">
        <ng-template pTemplate="header">
          <tr class="bg-gray-50 text-xs font-semibold text-gray-600">
            <th class="w-12">#</th>
            <th>Message ID</th>
            <th>Ticker ID</th>
            <th>CUSIP</th>
            <th>Bias</th>
            <th>Date</th>
            <th>BID</th>
            <th>MID</th>
            <th>ASK</th>
            <th>Source</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-row let-i="rowIndex">
          <tr class="hover:bg-gray-50 transition text-sm">

            <td class="text-gray-500">{{ i + 1 }}</td>
            <td class="font-mono">{{ row.messageId }}</td>
            <td>{{ row.ticker }}</td>
            <td class="font-mono">{{ row.cusip }}</td>

            <td>
              <span class="px-3 py-1 rounded-full text-xs font-medium"
                [class]="row.bias === 'BWIC_COVER' 
                  ? 'bg-purple-100 text-purple-700' 
                  : 'bg-blue-100 text-blue-700'">
                {{ row.bias }}
              </span>
            </td>

            <td>{{ row.date }}</td>

            <td class="text-green-600 font-medium">{{ row.bid }}</td>
            <td>{{ row.mid }}</td>
            <td class="text-red-600 font-medium">{{ row.ask }}</td>

            <td>
              <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">
                {{ row.source }}
              </span>
            </td>

          </tr>
        </ng-template>

      </p-table>
    </p-card>

  </div>

  <!-- ================= FILTER MODAL ================= -->
  <p-dialog 
    [(visible)]="filterVisible" 
    [modal]="true" 
    [style]="{ width: '900px' }" 
    [draggable]="false"
    header="Filter"
    class="filter-dialog">

    <div class="space-y-4">

      <!-- Filter Conditions -->
      <div class="border border-gray-200 rounded-lg">
        
        <!-- Header -->
        <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
          <span class="text-sm font-semibold text-gray-700">Where</span>
        </div>

        <!-- Conditions -->
        <div class="p-4 space-y-3">
          <div *ngFor="let condition of filterConditions; let i = index" class="flex items-center gap-3">
            
            <!-- Column AutoComplete -->
            <div class="w-40">
              <p-autocomplete 
                [(ngModel)]="condition.column"
                [suggestions]="filteredColumnOptions"
                (completeMethod)="searchColumn($event)"
                placeholder="Column"
                [dropdown]="true">
              </p-autocomplete>
            </div>

            <!-- Operator AutoComplete -->
            <div class="w-40">
              <p-autocomplete 
                [(ngModel)]="condition.operator"
                [suggestions]="filteredOperatorOptions"
                (completeMethod)="searchOperator($event)"
                placeholder="Operator"
                [dropdown]="true">
              </p-autocomplete>
            </div>

            <!-- Values Input -->
            <input 
              pInputText 
              [(ngModel)]="condition.values" 
              placeholder="Values" 
              class="w-40">

            <!-- Remove Button -->
            <button 
              pButton 
              icon="pi pi-times" 
              class="p-button-text p-button-danger !p-2"
              (click)="removeCondition(i)">
            </button>

          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-wrap gap-2">
        <button pButton 
                icon="pi pi-plus" 
                label="Add Condition" 
                class="p-button-outlined !text-sm !py-2"
                (click)="addCondition()">
        </button>

        <button pButton 
                icon="pi pi-plus" 
                label="Add Subgroup" 
                class="p-button-outlined !text-sm !py-2"
                (click)="addSubgroup()">
        </button>

        <button pButton 
                icon="pi pi-plus" 
                label="Add Group" 
                class="p-button-outlined !text-sm !py-2"
                (click)="addGroup()">
        </button>

        <div class="flex-1"></div>

        <button pButton 
                label="Remove all filters" 
                class="p-button-text !text-sm !py-2"
                (click)="removeAllFilters()">
        </button>

        <button pButton 
                label="Apply Filters" 
                class="!bg-gray-900 !text-white !text-sm !py-2 !px-4"
                (click)="applyFilters()">
        </button>
      </div>

    </div>

  </p-dialog>

</div>

<!-- ================= EXPANDED TABLE VIEW ================= -->
<div *ngIf="isTableExpanded" class="fixed inset-0 bg-white z-50 p-6">
  <!-- Header with minimize button -->
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-xl font-semibold text-gray-900">Data Table - Full Screen</h3>
    <button 
      pButton 
      icon="pi pi-compress" 
      class="p-button-text p-button-plain !text-gray-500 hover:!text-gray-700"
      (click)="toggleTableExpansion()"
      pTooltip="Minimize Table">
    </button>
  </div>

  <!-- Search/Filter Bar (Always visible in expanded mode) -->
  <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-5 mb-6">

    <div class="flex flex-col sm:flex-row flex-wrap items-center gap-4">

      <span class="p-input-icon-left w-full sm:w-auto">
        <i class="pi pi-search"></i>
        <input pInputText placeholder="Search Message ID" class="w-full sm:w-64">
      </span>

      <div class="flex flex-wrap gap-3">
        <button pButton icon="pi pi-sliders-h" label="Filters" 
                (click)="showFilterDialog()" 
                class="p-button-outlined"></button>
        <button pButton icon="pi pi-file-import" label="Import ID via Excel" class="p-button-outlined"></button>
      </div>

      <div class="flex-1"></div>

      <div class="flex items-center gap-3">
        <button pButton icon="pi pi-download" label="Export All" class="p-button-text"></button>

        <div class="px-5 py-2 rounded-full bg-gray-100 text-gray-800 font-semibold flex items-center gap-3">
          Total Count
          <span class="px-4 py-1 bg-white rounded-full shadow text-lg font-bold">670</span>
        </div>

        <button pButton label="Fetch Data" class="!bg-gray-900 !text-white !py-2 !px-4 rounded-lg text-sm"></button>
      </div>

    </div>

    <div class="flex flex-wrap items-center gap-3 mt-5">
      <p-chip label="Color: Bwic Cover | Px: Less than 100" removable="true"></p-chip>
      <p-chip label="Color: Market | Date: Today" removable="true"></p-chip>
      <button class="text-xs text-blue-600 ml-auto hover:underline">Remove all filters</button>
    </div>

  </div>

  <!-- Expanded Table -->
  <p-table [value]="tableData" [scrollable]="true" scrollHeight="calc(100vh - 250px)">
    <ng-template pTemplate="header">
      <tr class="bg-gray-50 text-xs font-semibold text-gray-600">
        <th class="w-12">#</th>
        <th>Message ID</th>
        <th>Ticker ID</th>
        <th>CUSIP</th>
        <th>Bias</th>
        <th>Date</th>
        <th>BID</th>
        <th>MID</th>
        <th>ASK</th>
        <th>Source</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-row let-i="rowIndex">
      <tr class="hover:bg-gray-50 transition text-sm">

        <td class="text-gray-500">{{ i + 1 }}</td>
        <td class="font-mono">{{ row.messageId }}</td>
        <td>{{ row.ticker }}</td>
        <td class="font-mono">{{ row.cusip }}</td>

        <td>
          <span class="px-3 py-1 rounded-full text-xs font-medium"
            [class]="row.bias === 'BWIC_COVER' 
              ? 'bg-purple-100 text-purple-700' 
              : 'bg-blue-100 text-blue-700'">
            {{ row.bias }}
          </span>
        </td>

        <td>{{ row.date }}</td>

        <td class="text-green-600 font-medium">{{ row.bid }}</td>
        <td>{{ row.mid }}</td>
        <td class="text-red-600 font-medium">{{ row.ask }}</td>

        <td>
          <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">
            {{ row.source }}
          </span>
        </td>

      </tr>
    </ng-template>
  </p-table>
</div>